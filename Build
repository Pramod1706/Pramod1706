The error indicates that the Groovy sandbox is blocking the use of the Duration.between() method, which is a static method and hence not permitted within the sandbox environment.

To work around this issue without disabling the sandbox, you can avoid using Duration.between() and manually calculate the difference in seconds using ChronoUnit.SECONDS. Here's the updated script:

Updated Job 1 Jenkinsfile:

import java.time.LocalDateTime
import java.time.format.DateTimeFormatter
import java.time.temporal.ChronoUnit

pipeline {
    agent any
    parameters {
        string(name: 'TRIGGER_DATE', defaultValue: '2024-10-19', description: 'Date to trigger Job 2 (format: YYYY-MM-DD)')
        string(name: 'TRIGGER_TIME', defaultValue: '15:30', description: 'Time to trigger Job 2 (24-hour format: HH:mm)')
    }
    stages {
        stage('Schedule Job 2') {
            steps {
                script {
                    // Read parameters
                    def triggerDate = params.TRIGGER_DATE
                    def triggerTime = params.TRIGGER_TIME

                    // Parse the desired time using LocalDateTime
                    def formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm")
                    def triggerDateTime = LocalDateTime.parse("${triggerDate} ${triggerTime}", formatter)
                    def currentTime = LocalDateTime.now()

                    // Calculate the delay in seconds using ChronoUnit.SECONDS.between
                    def delayInSeconds = ChronoUnit.SECONDS.between(currentTime, triggerDateTime)

                    if (delayInSeconds > 0) {
                        echo "Waiting for ${delayInSeconds} seconds to trigger Job 2 at ${triggerDateTime}."
                        sleep time: delayInSeconds, unit: 'SECONDS'
                    } else {
                        echo "The specified time has already passed. Triggering Job 2 immediately."
                    }

                    // Trigger Job 2
                    build job: 'Job2'
                }
            }
        }
    }
}

Explanation:

The updated script uses ChronoUnit.SECONDS.between to calculate the delay, which should be more sandbox-friendly than Duration.between().

This avoids using restricted static methods and relies on safer operations permitted within the Groovy sandbox.


Try this revised script, and it should bypass the sandbox restrictions while still achieving the desired scheduling.
