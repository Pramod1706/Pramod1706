---
- name: Check Jira ticket status
  hosts: localhost
  vars:
    jira_issue_key: "{{ lookup('file', '/tmp/jira_issue_key.txt') }}"
    max_retries: 120  # 4 hours (120 * 2 minutes)
    delay: 120  # 2 minutes
  tasks:
    - name: Check Jira issue status
      uri:
        url: "https://your-jira-instance/rest/api/2/issue/{{ jira_issue_key }}"
        method: GET
        user: "{{ jira_username }}"
        password: "{{ jira_password }}"
        force_basic_auth: yes
        headers:
          Content-Type: "application/json"
        return_content: yes
      register: jira_issue_details
      until: jira_issue_details.json.fields.status.name == "Closed"
      retries: "{{ max_retries }}"
      delay: "{{ delay }}"

    - name: Show Jira issue details
      debug:
        var: jira_issue_details.json
