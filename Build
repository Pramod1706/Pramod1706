---
- name: Retrieve and print Jira ticket details using the uri module
  hosts: localhost
  tasks:
    - name: Get Jira ticket details
      uri:
        url: "https://your-jira-instance.atlassian.net/rest/api/2/issue/{{ ticket_id }}"
        method: GET
        user: "{{ jira_username }}"
        password: "{{ jira_api_token }}"
        force_basic_auth: yes
        return_content: yes
        headers:
          Content-Type: "application/json"
          Accept: "application/json"
      register: jira_response
      no_log: true

    - name: Check if the request was successful
      fail:
        msg: "Failed to retrieve Jira ticket details. HTTP status code: {{ jira_response.status }}"
      when: jira_response.status != 200

    - name: Parse the JSON response from Jira
      set_fact:
        jira_data: "{{ jira_response.json }}"

    - name: Print the Jira ticket status
      debug:
        msg: "The status of the Jira ticket is: {{ jira_data.fields.status.name }}"
