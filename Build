---
- name: Schedule a job in Ansible Tower using curl
  hosts: localhost
  vars:
    scheduleStartDateTime: "2025-10-23T11:45:00"  # Example date, replace with actual value
  tasks:
    - name: Format the schedule start date
      set_fact:
        formatted_date: "{{ scheduleStartDateTime | to_datetime('%Y-%m-%dT%H:%M:%S') | strftime('%Y%m%dT%H%M%SZ') }}"

    - name: Print formatted date
      debug:
        msg: "Formatted Date: {{ formatted_date }}"

    - name: Schedule job in Ansible Tower
      shell: |
        curl -X POST -u "your_username:your_password" \
        "https://alm-aapuat-sdc.hc.cloud.uk.hsbc/api/v2/job_templates/150068/schedules/" \
        -H "Content-Type: application/json" \
        -d '{
              "name": "test sch",
              "rrule": "DTSTART:{{ formatted_date }}\\nRRULE:FREQ=DAILY;INTERVAL=1;COUNT=1"
            }'
      register: response

    - name: Show response
      debug:
        var: response.stdout
